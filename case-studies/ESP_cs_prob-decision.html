<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Taller de análisis de decisiones - Caso de estudio: Probabilidades y árboles de decisión</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      Taller de análisis de decisiones
      </li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Taller de análisis de decisiones</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Recursos Amua</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../case-studies/2024_chds_amua_tutorials_tp.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Center for Health Decision Sciences Amua Resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vimeo.com/888816562" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Watch (Amua Video Tutorial)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vimeo.com/888816572" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introductions (Amua Video Tutorial)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vimeo.com/888812546" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Layout (Amua Video Tutorial)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vimeo.com/888816515" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decision Trees (Amua Video Tutorial)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vimeo.com/888816536" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Markov Models (Amua Video Tutorial)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instructores</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="ESP_cs_prob-decision.docx"><i class="bi bi-file-word"></i>MS Word</a></li><li><a href="ESP_cs_prob-decision.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Caso de estudio: Probabilidades y árboles de decisión</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Puede descargar las versiones en PDF y Microsoft Word de este estudio de caso utilizando los enlaces de la derecha.</p>
</div>
</div>
<section id="caso-1" class="level1">
<h1>Caso 1</h1>
<p>En una comunidad hipotética, el 60% de las personas consumen al menos 6 bebidas alcohólicas a la semana y el 50% tiene sobrepeso. El porcentaje de personas que tienen sobrepeso y consumen esta cantidad de alcohol es del 40%. Construye una tabla de 2x2 para responder a las preguntas (a)-(c) siguientes. Para la parte (d), construya un árbol de decisión.</p>
<ul>
<li><em>¿Qué porcentaje de personas consumen al menos 6 bebidas alcohólicas a la semana, tienen sobrepeso o entran en ambas categorías?</em>.</li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
<ul>
<li>*Toma una muestra aleatoria de una persona de la comunidad y descubre que consume al menos 6 bebidas alcohólicas a la semana. ¿Cuál es la probabilidad de que tenga sobrepeso? ¿Cuál es la probabilidad de que tenga sobrepeso?</li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
<ul>
<li><em>¿Cuál es la probabilidad de que alguien de esta comunidad consuma al menos 6 bebidas alcohólicas a la semana si tiene sobrepeso?</em></li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
</section>
<section id="caso-2" class="level1">
<h1>Caso 2</h1>
<p>Un nuevo procedimiento de cribado puede detectar el 80% de las mujeres diagnosticadas de cáncer de mama cáncer de mama pero identificará falsamente al 2% sin cáncer de mama. La prevalencia del cáncer de mama en la población es de 1,6 en 100</p>
<ul>
<li><em>¿Cuál es la probabilidad de que una mujer no tenga cáncer de mama si la prueba es negativa?</em></li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
<ul>
<li><em>¿Cuál es la probabilidad de que una mujer tenga cáncer de mama si la prueba es positiva?</em></li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
</section>
<section id="caso-3" class="level1">
<h1>Caso 3</h1>
<p>A un paciente se le detecta un aneurisma aórtico abdominal (AAA) de 5 cm de de tamaño. Si se le opera ahora y sobrevive, tendrá una esperanza de vida de 3 años más. En una serie de 100 pacientes similares de su hospital, 6 murieron inmediatamente después de la operación. Si eliges vigilar al paciente, el 60% romperá su AAA en casa (supongamos que una media de 1 año después). De los que rompen su AAA, el 30% morirá, mientras que el otro % se someterá a cirugía de urgencia y sobrevivirá, permitiendo al paciente sobreviva los 3 años de esperanza de vida.</p>
<ul>
<li>*Dibujar un árbol de decisión para el problema de elegir si se opera electiva. Recuerde que debe considerar la esperanza de vida como un resultado. como un resultado. ¿Cuál es la opción preferida?</li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
<ul>
<li><em>Un intervalo de confianza del 95% para la tasa de mortalidad de la cirugía electiva electiva en su hospital oscila entre el 1,4 y el 12,7%. ¿Influye esto sus pensamientos? ¿Por qué? ¿Necesita más información sobre su estimación de la mortalidad? ¿Por qué? (Nota: Para esto último, calcule la tasa de mortalidad para la que es indiferente entre las dos opciones)</em></li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
</section>
<section id="caso-4" class="level1">
<h1>Caso 4</h1>
<p>Un paciente acude a Urgencias con dolor abdominal. Según el médico de urgencias, usted estima que la probabilidad de apendicitis del paciente es de 0,16. Si el paciente tiene realmente apendicitis, la probabilidad de que el apéndice ya estuviera perforado en el momento en que el paciente acude a Urgencias es de 0,1875. También puede observar al paciente durante 6 horas para estar seguro de que su diagnóstico es correcto. Si su diagnóstico acaba siendo correcto, el 24% de apéndice perforado al cabo de 6 horas (Nota: esta cifra no es la que se número no es el que entra en su árbol. Debe tener en cuenta el 18,75% apéndice perforado cuando el paciente ingresó en el hospital). hospital).</p>
<p>Si el apéndice está perforado en el momento en que el paciente se presenta en urgencias o al cabo de 6 horas, hay un 0,84 de probabilidades de que los síntomas empeoren y un 0,16 de que permanezcan igual. Si el paciente tiene apendicitis pero el apéndice no revienta al cabo de 6 horas, hay una probabilidad de 0,8 de que los síntomas empeoren y una probabilidad de 0,2 de que permanezcan igual. Si el apéndice no está enfermo, hay un 0,39 de probabilidad de que los síntomas sigan igual en 6 horas, un 0,61 probabilidad de que mejoren y ninguna probabilidad de que empeoren.</p>
<ul>
<li>Calcular la probabilidad de que un paciente tenga un apéndice perforado al cabo de 6 horas, dado que tenía apendicitis pero no estaba perforado en el momento de ingresar en el hospital</li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
<p>Dibuja un árbol de decisión para calcular las probabilidades planteadas en las preguntas 3-6.</p>
<ul>
<li><em>Calcule la probabilidad de que el paciente tenga un apéndice perforado apéndice al principio de las 6 horas.</em></li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
<p>P(Perforación al comienzo de las seis horas) = 0,1600 * 0,1875 = 0.0300. Esta es la proporción de pacientes con apendicitis multiplicada por la probabilidad condicional de perforación dada la apendicitis en el en el momento en que el paciente ingresa en el hospital.</p>
<ul>
<li><em>Calcular la probabilidad de que el paciente tenga una perforación de apéndice si espera 6 horas</em></li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
<ul>
<li>Calcule la probabilidad de que los síntomas del paciente 1) empeoren empeoren, 2) permanezcan igual, y 3) mejoren.*</li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
<ul>
<li><em>Calcule la probabilidad condicional de que el paciente tenga una apéndice perforado si los síntomas 1) empeoran; 2) permanecen igual o 3) mejoran</em>.</li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>
<ul>
<li><em>Calcule la probabilidad condicional de que el paciente tenga apendicitis si 1) los síntomas empeoran, 2) permanecen igual, o 3) mejoran</em></li>
</ul>
<div class="cell">

</div>
<div class="cell">
<!-- Only shows up in HTML output -->
<div style="margin-top: 100px;"></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>