<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Taller de análisis de decisiones - Injury Markov Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      Taller de análisis de decisiones
      </li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Taller de análisis de decisiones</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Recursos Amua</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../case-studies/2024_chds_amua_tutorials_tp.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Center for Health Decision Sciences Amua Resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vimeo.com/888816562" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Watch (Amua Video Tutorial)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vimeo.com/888816572" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introductions (Amua Video Tutorial)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vimeo.com/888812546" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Layout (Amua Video Tutorial)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vimeo.com/888816515" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decision Trees (Amua Video Tutorial)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vimeo.com/888816536" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Markov Models (Amua Video Tutorial)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://graveja0.github.io/dalys/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modelización de Markov avanzada</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://smdm-europe23-what-they-didnt-teach.netlify.app" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Taller de modelado intermedio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instructores</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#injury-incidence-rates" id="toc-injury-incidence-rates" class="nav-link" data-scroll-target="#injury-incidence-rates">Injury Incidence Rates</a>
  <ul class="collapse">
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">Data Sources</a></li>
  <li><a href="#proposed-incidence-rates-and-probabilities" id="toc-proposed-incidence-rates-and-probabilities" class="nav-link" data-scroll-target="#proposed-incidence-rates-and-probabilities">Proposed Incidence Rates and Probabilities</a>
  <ul class="collapse">
  <li><a href="#transition-from-no-injury-healthy" id="toc-transition-from-no-injury-healthy" class="nav-link" data-scroll-target="#transition-from-no-injury-healthy">Transition from No Injury (Healthy)</a></li>
  <li><a href="#recovery-transitions" id="toc-recovery-transitions" class="nav-link" data-scroll-target="#recovery-transitions">Recovery Transitions</a></li>
  </ul></li>
  <li><a href="#proposed-health-state-utility-values" id="toc-proposed-health-state-utility-values" class="nav-link" data-scroll-target="#proposed-health-state-utility-values">Proposed Health State Utility Values</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Injury Markov Model</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 515.39 332.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>MarkovModel</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-328 511.39,-328 511.39,4 -4,4"></polygon>
<!-- NoInjury -->
<g id="node1" class="node">
<title>NoInjury</title>
<ellipse fill="lightblue" stroke="lightblue" cx="236.32" cy="-270" rx="88.04" ry="18"></ellipse>
<text text-anchor="middle" x="236.32" y="-265.8" font-family="Times,serif" font-size="14.00">No Injury (Healthy)</text>
</g>
<!-- NoInjury&#45;&gt;NoInjury -->
<g id="edge15" class="edge">
<title>NoInjury:n-&gt;NoInjury:n</title>
<path fill="none" stroke="black" d="M236.32,-288C245.32,-300 245.32,-324 236.32,-324 229.29,-324 227.76,-309.35 231.71,-297.22"></path>
<polygon fill="black" stroke="black" points="234.98,-298.51 236.32,-288 228.72,-295.38 234.98,-298.51"></polygon>
</g>
<!-- MinorInjury -->
<g id="node2" class="node">
<title>MinorInjury</title>
<ellipse fill="lightblue" stroke="lightblue" cx="407.32" cy="-198" rx="61.39" ry="18"></ellipse>
<text text-anchor="middle" x="407.32" y="-193.8" font-family="Times,serif" font-size="14.00">Minor Injury</text>
</g>
<!-- NoInjury&#45;&gt;MinorInjury -->
<g id="edge1" class="edge">
<title>NoInjury-&gt;MinorInjury</title>
<path fill="none" stroke="black" d="M269.37,-253.12C295.18,-242.03 331.25,-227.24 360.09,-215.93"></path>
<polygon fill="black" stroke="black" points="361.52,-219.13 369.57,-212.24 358.98,-212.61 361.52,-219.13"></polygon>
</g>
<!-- ModerateInjury -->
<g id="node3" class="node">
<title>ModerateInjury</title>
<ellipse fill="lightblue" stroke="lightblue" cx="236.32" cy="-198" rx="74.1" ry="18"></ellipse>
<text text-anchor="middle" x="236.32" y="-193.8" font-family="Times,serif" font-size="14.00">Moderate Injury</text>
</g>
<!-- NoInjury&#45;&gt;ModerateInjury -->
<g id="edge2" class="edge">
<title>NoInjury-&gt;ModerateInjury</title>
<path fill="none" stroke="black" d="M230.41,-251.7C229.61,-243.98 229.39,-234.71 229.73,-226.11"></path>
<polygon fill="black" stroke="black" points="233.22,-226.32 230.43,-216.1 226.24,-225.84 233.22,-226.32"></polygon>
</g>
<!-- SevereInjury -->
<g id="node4" class="node">
<title>SevereInjury</title>
<ellipse fill="lightblue" stroke="lightblue" cx="81.32" cy="-198" rx="63.15" ry="18"></ellipse>
<text text-anchor="middle" x="81.32" y="-193.8" font-family="Times,serif" font-size="14.00">Severe Injury</text>
</g>
<!-- NoInjury&#45;&gt;SevereInjury -->
<g id="edge3" class="edge">
<title>NoInjury-&gt;SevereInjury</title>
<path fill="none" stroke="black" d="M197.01,-253.81C172.88,-243.48 142.26,-229.72 118.52,-218.57"></path>
<polygon fill="black" stroke="black" points="120.01,-215.4 109.47,-214.28 117.01,-221.72 120.01,-215.4"></polygon>
</g>
<!-- Death -->
<g id="node6" class="node">
<title>Death</title>
<ellipse fill="lightgray" stroke="lightgray" cx="426.32" cy="-54" rx="34.19" ry="18"></ellipse>
<text text-anchor="middle" x="426.32" y="-49.8" font-family="Times,serif" font-size="14.00">Death</text>
</g>
<!-- NoInjury&#45;&gt;Death -->
<g id="edge4" class="edge">
<title>NoInjury-&gt;Death</title>
<path fill="none" stroke="black" d="M318.58,-263.28C385.81,-256.69 473.23,-243.07 495.32,-216 530.04,-173.47 481.48,-110.86 449.83,-77.64"></path>
<polygon fill="black" stroke="black" points="452.09,-74.94 442.6,-70.24 447.09,-79.84 452.09,-74.94"></polygon>
</g>
<!-- MinorInjury&#45;&gt;NoInjury -->
<g id="edge5" class="edge">
<title>MinorInjury-&gt;NoInjury</title>
<path fill="none" stroke="black" d="M377.02,-213.7C352.3,-224.38 316.96,-238.9 287.84,-250.39"></path>
<polygon fill="black" stroke="black" points="286.26,-247.25 278.23,-254.15 288.81,-253.76 286.26,-247.25"></polygon>
</g>
<!-- MinorInjury&#45;&gt;MinorInjury -->
<g id="edge16" class="edge">
<title>MinorInjury:e-&gt;MinorInjury:e</title>
<path fill="none" stroke="black" d="M468.32,-198C474.52,-216 486.52,-216 486.52,-198 486.52,-183.94 479.19,-180.86 473.04,-188.77"></path>
<polygon fill="black" stroke="black" points="469.75,-187.5 468.32,-198 475.99,-190.69 469.75,-187.5"></polygon>
</g>
<!-- RecoveredSequelae -->
<g id="node5" class="node">
<title>RecoveredSequelae</title>
<ellipse fill="lightblue" stroke="lightblue" cx="289.32" cy="-126" rx="109.35" ry="18"></ellipse>
<text text-anchor="middle" x="289.32" y="-121.8" font-family="Times,serif" font-size="14.00">Recovered with Sequelae</text>
</g>
<!-- MinorInjury&#45;&gt;RecoveredSequelae -->
<g id="edge6" class="edge">
<title>MinorInjury-&gt;RecoveredSequelae</title>
<path fill="none" stroke="black" d="M381.43,-181.64C365.25,-172.04 344.17,-159.53 326.25,-148.91"></path>
<polygon fill="black" stroke="black" points="327.61,-145.64 317.22,-143.55 324.03,-151.66 327.61,-145.64"></polygon>
</g>
<!-- MinorInjury&#45;&gt;Death -->
<g id="edge7" class="edge">
<title>MinorInjury-&gt;Death</title>
<path fill="none" stroke="black" d="M409.62,-179.87C412.85,-155.67 418.8,-111.21 422.66,-82.39"></path>
<polygon fill="black" stroke="black" points="426.17,-82.57 424.02,-72.19 419.23,-81.64 426.17,-82.57"></polygon>
</g>
<!-- ModerateInjury&#45;&gt;NoInjury -->
<g id="edge8" class="edge">
<title>ModerateInjury-&gt;NoInjury</title>
<path fill="none" stroke="black" d="M242.22,-216.1C243.03,-223.79 243.26,-233.05 242.93,-241.67"></path>
<polygon fill="black" stroke="black" points="239.43,-241.48 242.24,-251.7 246.42,-241.96 239.43,-241.48"></polygon>
</g>
<!-- ModerateInjury&#45;&gt;ModerateInjury -->
<g id="edge17" class="edge">
<title>ModerateInjury:e-&gt;ModerateInjury:e</title>
<path fill="none" stroke="black" d="M310.32,-198C316.38,-216 328.38,-216 328.38,-198 328.38,-183.94 321.05,-180.86 314.96,-188.77"></path>
<polygon fill="black" stroke="black" points="311.69,-187.49 310.32,-198 317.94,-190.64 311.69,-187.49"></polygon>
</g>
<!-- ModerateInjury&#45;&gt;RecoveredSequelae -->
<g id="edge9" class="edge">
<title>ModerateInjury-&gt;RecoveredSequelae</title>
<path fill="none" stroke="black" d="M249.15,-180.05C255.44,-171.75 263.14,-161.58 270.11,-152.38"></path>
<polygon fill="black" stroke="black" points="273,-154.36 276.24,-144.28 267.42,-150.14 273,-154.36"></polygon>
</g>
<!-- DeathInjury -->
<g id="node7" class="node">
<title>DeathInjury</title>
<ellipse fill="lightgray" stroke="lightgray" cx="81.32" cy="-126" rx="81.09" ry="18"></ellipse>
<text text-anchor="middle" x="81.32" y="-121.8" font-family="Times,serif" font-size="14.00">Death from Injury</text>
</g>
<!-- ModerateInjury&#45;&gt;DeathInjury -->
<g id="edge10" class="edge">
<title>ModerateInjury-&gt;DeathInjury</title>
<path fill="none" stroke="black" d="M202.69,-181.81C179.8,-171.47 149.28,-157.69 124.58,-146.54"></path>
<polygon fill="black" stroke="black" points="125.98,-143.33 115.43,-142.4 123.1,-149.71 125.98,-143.33"></polygon>
</g>
<!-- SevereInjury&#45;&gt;NoInjury -->
<g id="edge11" class="edge">
<title>SevereInjury-&gt;NoInjury</title>
<path fill="none" stroke="black" d="M117.52,-212.86C141.44,-223.04 172.69,-237.05 197.18,-248.52"></path>
<polygon fill="black" stroke="black" points="196.01,-251.84 206.55,-252.94 199,-245.51 196.01,-251.84"></polygon>
</g>
<!-- SevereInjury&#45;&gt;SevereInjury -->
<g id="edge18" class="edge">
<title>SevereInjury:w-&gt;SevereInjury:w</title>
<path fill="none" stroke="black" d="M17.32,-198C12,-216 0,-216 0,-198 0,-183.94 7.32,-180.86 13.07,-188.77"></path>
<polygon fill="black" stroke="black" points="9.96,-190.39 17.32,-198 16.31,-187.45 9.96,-190.39"></polygon>
</g>
<!-- SevereInjury&#45;&gt;RecoveredSequelae -->
<g id="edge12" class="edge">
<title>SevereInjury-&gt;RecoveredSequelae</title>
<path fill="none" stroke="black" d="M120.45,-183.83C152.4,-173.08 197.94,-157.75 233.69,-145.72"></path>
<polygon fill="black" stroke="black" points="235.13,-148.93 243.49,-142.43 232.89,-142.3 235.13,-148.93"></polygon>
</g>
<!-- SevereInjury&#45;&gt;DeathInjury -->
<g id="edge13" class="edge">
<title>SevereInjury-&gt;DeathInjury</title>
<path fill="none" stroke="black" d="M81.32,-179.7C81.32,-171.98 81.32,-162.71 81.32,-154.11"></path>
<polygon fill="black" stroke="black" points="84.82,-154.1 81.32,-144.1 77.82,-154.1 84.82,-154.1"></polygon>
</g>
<!-- RecoveredSequelae&#45;&gt;RecoveredSequelae -->
<g id="edge19" class="edge">
<title>RecoveredSequelae:s-&gt;RecoveredSequelae:s</title>
<path fill="none" stroke="black" d="M289.32,-108C298.32,-96 298.32,-72 289.32,-72 282.29,-72 280.76,-86.65 284.71,-98.78"></path>
<polygon fill="black" stroke="black" points="281.72,-100.62 289.32,-108 287.98,-97.49 281.72,-100.62"></polygon>
</g>
<!-- RecoveredSequelae&#45;&gt;Death -->
<g id="edge14" class="edge">
<title>RecoveredSequelae-&gt;Death</title>
<path fill="none" stroke="black" d="M321.1,-108.76C342.82,-97.67 371.53,-83 393.47,-71.79"></path>
<polygon fill="black" stroke="black" points="395.11,-74.88 402.42,-67.21 391.92,-68.65 395.11,-74.88"></polygon>
</g>
<!-- Death&#45;&gt;Death -->
<g id="edge20" class="edge">
<title>Death:s-&gt;Death:s</title>
<path fill="none" stroke="black" d="M426.32,-36C435.32,-24 435.32,0 426.32,0 419.29,0 417.76,-14.65 421.71,-26.78"></path>
<polygon fill="black" stroke="black" points="418.72,-28.62 426.32,-36 424.98,-25.49 418.72,-28.62"></polygon>
</g>
<!-- DeathInjury&#45;&gt;DeathInjury -->
<g id="edge21" class="edge">
<title>DeathInjury:s-&gt;DeathInjury:s</title>
<path fill="none" stroke="black" d="M81.32,-108C90.32,-96 90.32,-72 81.32,-72 74.29,-72 72.76,-86.65 76.71,-98.78"></path>
<polygon fill="black" stroke="black" points="73.72,-100.62 81.32,-108 79.98,-97.49 73.72,-100.62"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 522.93 332.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>MarkovModel</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-328 518.93,-328 518.93,4 -4,4"></polygon>
<!-- SinLesion -->
<g id="node1" class="node">
<title>SinLesion</title>
<ellipse fill="lightblue" stroke="lightblue" cx="242.91" cy="-270" rx="99.59" ry="18"></ellipse>
<text text-anchor="middle" x="242.91" y="-265.8" font-family="Times,serif" font-size="14.00">Sin Lesión (Saludable)</text>
</g>
<!-- SinLesion&#45;&gt;SinLesion -->
<g id="edge15" class="edge">
<title>SinLesion:n-&gt;SinLesion:n</title>
<path fill="none" stroke="black" d="M242.91,-288C251.91,-300 251.91,-324 242.91,-324 235.88,-324 234.34,-309.35 238.29,-297.22"></path>
<polygon fill="black" stroke="black" points="241.56,-298.51 242.91,-288 235.3,-295.38 241.56,-298.51"></polygon>
</g>
<!-- LesionLeve -->
<g id="node2" class="node">
<title>LesionLeve</title>
<ellipse fill="lightblue" stroke="lightblue" cx="416.91" cy="-198" rx="59.07" ry="18"></ellipse>
<text text-anchor="middle" x="416.91" y="-193.8" font-family="Times,serif" font-size="14.00">Lesión Leve</text>
</g>
<!-- SinLesion&#45;&gt;LesionLeve -->
<g id="edge1" class="edge">
<title>SinLesion-&gt;LesionLeve</title>
<path fill="none" stroke="black" d="M277.05,-252.94C303.54,-241.77 340.44,-226.92 369.73,-215.63"></path>
<polygon fill="black" stroke="black" points="371.26,-218.79 379.35,-211.94 368.76,-212.25 371.26,-218.79"></polygon>
</g>
<!-- LesionModerada -->
<g id="node3" class="node">
<title>LesionModerada</title>
<ellipse fill="lightblue" stroke="lightblue" cx="242.91" cy="-198" rx="78.76" ry="18"></ellipse>
<text text-anchor="middle" x="242.91" y="-193.8" font-family="Times,serif" font-size="14.00">Lesión Moderada</text>
</g>
<!-- SinLesion&#45;&gt;LesionModerada -->
<g id="edge2" class="edge">
<title>SinLesion-&gt;LesionModerada</title>
<path fill="none" stroke="black" d="M236.99,-251.7C236.2,-243.98 235.97,-234.71 236.31,-226.11"></path>
<polygon fill="black" stroke="black" points="239.81,-226.32 237.01,-216.1 232.82,-225.84 239.81,-226.32"></polygon>
</g>
<!-- LesionGrave -->
<g id="node4" class="node">
<title>LesionGrave</title>
<ellipse fill="lightblue" stroke="lightblue" cx="82.91" cy="-198" rx="63.15" ry="18"></ellipse>
<text text-anchor="middle" x="82.91" y="-193.8" font-family="Times,serif" font-size="14.00">Lesión Grave</text>
</g>
<!-- SinLesion&#45;&gt;LesionGrave -->
<g id="edge3" class="edge">
<title>SinLesion-&gt;LesionGrave</title>
<path fill="none" stroke="black" d="M201.68,-253.46C176.8,-243.12 145.41,-229.44 121.1,-218.38"></path>
<polygon fill="black" stroke="black" points="122.37,-215.12 111.82,-214.13 119.45,-221.48 122.37,-215.12"></polygon>
</g>
<!-- Muerte -->
<g id="node6" class="node">
<title>Muerte</title>
<ellipse fill="lightgray" stroke="lightgray" cx="431.91" cy="-54" rx="38.85" ry="18"></ellipse>
<text text-anchor="middle" x="431.91" y="-49.8" font-family="Times,serif" font-size="14.00">Muerte</text>
</g>
<!-- SinLesion&#45;&gt;Muerte -->
<g id="edge4" class="edge">
<title>SinLesion-&gt;Muerte</title>
<path fill="none" stroke="black" d="M333.54,-262.51C399.78,-255.67 481.6,-242.09 502.91,-216 537.61,-173.51 488.68,-111.39 456.38,-78.1"></path>
<polygon fill="black" stroke="black" points="458.52,-75.29 448.98,-70.68 453.56,-80.23 458.52,-75.29"></polygon>
</g>
<!-- LesionLeve&#45;&gt;SinLesion -->
<g id="edge5" class="edge">
<title>LesionLeve-&gt;SinLesion</title>
<path fill="none" stroke="black" d="M386.48,-213.49C361.54,-224.07 325.8,-238.51 296.17,-250.02"></path>
<polygon fill="black" stroke="black" points="294.86,-246.77 286.79,-253.64 297.38,-253.3 294.86,-246.77"></polygon>
</g>
<!-- LesionLeve&#45;&gt;LesionLeve -->
<g id="edge16" class="edge">
<title>LesionLeve:e-&gt;LesionLeve:e</title>
<path fill="none" stroke="black" d="M475.91,-198C481.94,-216 493.94,-216 493.94,-198 493.94,-183.94 486.62,-180.86 480.54,-188.77"></path>
<polygon fill="black" stroke="black" points="477.26,-187.49 475.91,-198 483.52,-190.63 477.26,-187.49"></polygon>
</g>
<!-- RecuperadoSecuelas -->
<g id="node5" class="node">
<title>RecuperadoSecuelas</title>
<ellipse fill="lightblue" stroke="lightblue" cx="293.91" cy="-126" rx="109.92" ry="18"></ellipse>
<text text-anchor="middle" x="293.91" y="-121.8" font-family="Times,serif" font-size="14.00">Recuperado con Secuelas</text>
</g>
<!-- LesionLeve&#45;&gt;RecuperadoSecuelas -->
<g id="edge6" class="edge">
<title>LesionLeve-&gt;RecuperadoSecuelas</title>
<path fill="none" stroke="black" d="M390.22,-181.81C373.02,-172.02 350.4,-159.15 331.41,-148.34"></path>
<polygon fill="black" stroke="black" points="333.11,-145.28 322.69,-143.38 329.65,-151.37 333.11,-145.28"></polygon>
</g>
<!-- LesionLeve&#45;&gt;Muerte -->
<g id="edge7" class="edge">
<title>LesionLeve-&gt;Muerte</title>
<path fill="none" stroke="black" d="M418.72,-179.87C421.27,-155.67 425.97,-111.21 429.01,-82.39"></path>
<polygon fill="black" stroke="black" points="432.52,-82.5 430.09,-72.19 425.56,-81.77 432.52,-82.5"></polygon>
</g>
<!-- LesionModerada&#45;&gt;SinLesion -->
<g id="edge8" class="edge">
<title>LesionModerada-&gt;SinLesion</title>
<path fill="none" stroke="black" d="M248.8,-216.1C249.61,-223.79 249.84,-233.05 249.51,-241.67"></path>
<polygon fill="black" stroke="black" points="246.02,-241.48 248.82,-251.7 253,-241.96 246.02,-241.48"></polygon>
</g>
<!-- LesionModerada&#45;&gt;LesionModerada -->
<g id="edge17" class="edge">
<title>LesionModerada:e-&gt;LesionModerada:e</title>
<path fill="none" stroke="black" d="M321.91,-198C327.79,-216 339.79,-216 339.79,-198 339.79,-183.94 332.46,-180.86 326.45,-188.77"></path>
<polygon fill="black" stroke="black" points="323.19,-187.48 321.91,-198 329.47,-190.58 323.19,-187.48"></polygon>
</g>
<!-- LesionModerada&#45;&gt;RecuperadoSecuelas -->
<g id="edge9" class="edge">
<title>LesionModerada-&gt;RecuperadoSecuelas</title>
<path fill="none" stroke="black" d="M255.25,-180.05C261.3,-171.75 268.71,-161.58 275.42,-152.38"></path>
<polygon fill="black" stroke="black" points="278.26,-154.42 281.32,-144.28 272.6,-150.3 278.26,-154.42"></polygon>
</g>
<!-- MuerteLesion -->
<g id="node7" class="node">
<title>MuerteLesion</title>
<ellipse fill="lightgray" stroke="lightgray" cx="82.91" cy="-126" rx="82.81" ry="18"></ellipse>
<text text-anchor="middle" x="82.91" y="-121.8" font-family="Times,serif" font-size="14.00">Muerte por Lesión</text>
</g>
<!-- LesionModerada&#45;&gt;MuerteLesion -->
<g id="edge10" class="edge">
<title>LesionModerada-&gt;MuerteLesion</title>
<path fill="none" stroke="black" d="M208.19,-181.81C184.56,-171.47 153.06,-157.69 127.56,-146.54"></path>
<polygon fill="black" stroke="black" points="128.67,-143.2 118.11,-142.4 125.87,-149.62 128.67,-143.2"></polygon>
</g>
<!-- LesionGrave&#45;&gt;SinLesion -->
<g id="edge11" class="edge">
<title>LesionGrave-&gt;SinLesion</title>
<path fill="none" stroke="black" d="M119.64,-212.67C144.33,-222.86 176.76,-236.95 202.22,-248.48"></path>
<polygon fill="black" stroke="black" points="201.05,-251.8 211.6,-252.76 203.95,-245.43 201.05,-251.8"></polygon>
</g>
<!-- LesionGrave&#45;&gt;LesionGrave -->
<g id="edge18" class="edge">
<title>LesionGrave:w-&gt;LesionGrave:w</title>
<path fill="none" stroke="black" d="M18.91,-198C13.58,-216 1.58,-216 1.58,-198 1.58,-183.94 8.91,-180.86 14.65,-188.77"></path>
<polygon fill="black" stroke="black" points="11.54,-190.39 18.91,-198 17.9,-187.45 11.54,-190.39"></polygon>
</g>
<!-- LesionGrave&#45;&gt;RecuperadoSecuelas -->
<g id="edge12" class="edge">
<title>LesionGrave-&gt;RecuperadoSecuelas</title>
<path fill="none" stroke="black" d="M122.59,-183.83C155,-173.08 201.21,-157.75 237.47,-145.72"></path>
<polygon fill="black" stroke="black" points="239.02,-148.9 247.41,-142.43 236.82,-142.25 239.02,-148.9"></polygon>
</g>
<!-- LesionGrave&#45;&gt;MuerteLesion -->
<g id="edge13" class="edge">
<title>LesionGrave-&gt;MuerteLesion</title>
<path fill="none" stroke="black" d="M82.91,-179.7C82.91,-171.98 82.91,-162.71 82.91,-154.11"></path>
<polygon fill="black" stroke="black" points="86.41,-154.1 82.91,-144.1 79.41,-154.1 86.41,-154.1"></polygon>
</g>
<!-- RecuperadoSecuelas&#45;&gt;RecuperadoSecuelas -->
<g id="edge19" class="edge">
<title>RecuperadoSecuelas:s-&gt;RecuperadoSecuelas:s</title>
<path fill="none" stroke="black" d="M293.91,-108C302.91,-96 302.91,-72 293.91,-72 286.88,-72 285.34,-86.65 289.29,-98.78"></path>
<polygon fill="black" stroke="black" points="286.3,-100.62 293.91,-108 292.56,-97.49 286.3,-100.62"></polygon>
</g>
<!-- RecuperadoSecuelas&#45;&gt;Muerte -->
<g id="edge14" class="edge">
<title>RecuperadoSecuelas-&gt;Muerte</title>
<path fill="none" stroke="black" d="M325.91,-108.76C347.37,-97.88 375.61,-83.56 397.54,-72.43"></path>
<polygon fill="black" stroke="black" points="399.18,-75.53 406.52,-67.88 396.01,-69.28 399.18,-75.53"></polygon>
</g>
<!-- Muerte&#45;&gt;Muerte -->
<g id="edge20" class="edge">
<title>Muerte:s-&gt;Muerte:s</title>
<path fill="none" stroke="black" d="M431.91,-36C440.91,-24 440.91,0 431.91,0 424.88,0 423.34,-14.65 427.29,-26.78"></path>
<polygon fill="black" stroke="black" points="424.3,-28.62 431.91,-36 430.56,-25.49 424.3,-28.62"></polygon>
</g>
<!-- MuerteLesion&#45;&gt;MuerteLesion -->
<g id="edge21" class="edge">
<title>MuerteLesion:s-&gt;MuerteLesion:s</title>
<path fill="none" stroke="black" d="M82.91,-108C91.91,-96 91.91,-72 82.91,-72 75.88,-72 74.34,-86.65 78.29,-98.78"></path>
<polygon fill="black" stroke="black" points="75.3,-100.62 82.91,-108 81.56,-97.49 75.3,-100.62"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This document provides proposed injury incidence rates based on real-world data for creating a Markov model to evaluate the cost-effectiveness of strategies to prevent injuries from gunpowder and fireworks. The proposed rates are converted to probabilities for use in the Markov model.</p>
</section>
<section id="injury-incidence-rates" class="level1">
<h1>Injury Incidence Rates</h1>
<section id="data-sources" class="level2">
<h2 class="anchored" data-anchor-id="data-sources">Data Sources</h2>
<ol type="1">
<li><strong>Centers for Disease Control and Prevention (CDC)</strong>
<ul>
<li>The CDC provides detailed reports on injuries related to fireworks, including rates of different types of injuries (minor, moderate, severe) and outcomes.</li>
<li><a href="https://www.cdc.gov/fireworks/injury-data/index.html">CDC Fireworks Safety</a></li>
</ul></li>
<li><strong>Consumer Product Safety Commission (CPSC)</strong>
<ul>
<li>The CPSC publishes annual reports on fireworks-related injuries, including detailed statistics on the nature and severity of injuries.</li>
<li><a href="https://www.cpsc.gov/s3fs-public/2020-Fireworks-Report.pdf">CPSC Fireworks Reports</a></li>
</ul></li>
<li><strong>National Fire Protection Association (NFPA)</strong>
<ul>
<li>The NFPA provides reports on firework injuries and fatalities, including detailed data on the types of injuries and their frequencies.</li>
<li><a href="https://www.nfpa.org/Public-Education/By-topic/Seasonal/Fireworks">NFPA Fireworks</a></li>
</ul></li>
<li><strong>Journal Articles and Epidemiological Studies</strong>
<ul>
<li>Several peer-reviewed journal articles provide data on fireworks and gunpowder-related injuries, including their incidence rates and severity.</li>
<li>Witsaman RJ, Comstock RD, Smith GA. Pediatric fireworks-related injuries in the United States: 1990–2003. Pediatrics. 2006;118(1):296-303.</li>
<li>Smith GA, Knapp JF, Barnett TM, Shields BJ. The rockets’ red glare, the bombs bursting in air: fireworks-related injuries to children. Pediatrics. 1996;98(1):1-9.</li>
</ul></li>
<li><strong>World Health Organization (WHO)</strong>
<ul>
<li>The WHO provides global data on injuries and their prevention, including sections related to burns and trauma from explosive materials.</li>
<li><a href="https://www.who.int/news-room/fact-sheets/detail/burns">WHO Burns</a></li>
</ul></li>
</ol>
</section>
<section id="proposed-incidence-rates-and-probabilities" class="level2">
<h2 class="anchored" data-anchor-id="proposed-incidence-rates-and-probabilities">Proposed Incidence Rates and Probabilities</h2>
<section id="transition-from-no-injury-healthy" class="level3">
<h3 class="anchored" data-anchor-id="transition-from-no-injury-healthy">Transition from No Injury (Healthy)</h3>
<ol type="1">
<li><strong>To Minor Injury</strong>
<ul>
<li>Incidence Rate: 7% per year</li>
<li>Probability: ( P = 1 - e^{-0.07} )</li>
<li><a href="https://www.cdc.gov/fireworks/injury-data/index.html">CDC Fireworks Safety</a></li>
<li><a href="https://www.cpsc.gov/s3fs-public/2020-Fireworks-Report.pdf">CPSC Fireworks Reports</a></li>
</ul></li>
<li><strong>To Moderate Injury</strong>
<ul>
<li>Incidence Rate: 2% per year</li>
<li>Probability: ( P = 1 - e^{-0.02} )</li>
<li>Smith GA, Knapp JF, Barnett TM, Shields BJ. Pediatrics. 1996;98(1):1-9.</li>
<li><a href="https://www.nfpa.org/Public-Education/By-topic/Seasonal/Fireworks">NFPA Fireworks</a></li>
</ul></li>
<li><strong>To Severe Injury</strong>
<ul>
<li>Incidence Rate: 0.5% per year</li>
<li>Probability: ( P = 1 - e^{-0.005} )</li>
<li>Witsaman RJ, Comstock RD, Smith GA. Pediatrics. 2006;118(1):296-303.</li>
<li><a href="https://www.who.int/news-room/fact-sheets/detail/burns">WHO Burns</a></li>
</ul></li>
<li><strong>To Death</strong>
<ul>
<li>Incidence Rate: 0.01% per year</li>
<li>Probability: ( P = 1 - e^{-0.0001} )</li>
<li><a href="https://www.cpsc.gov/s3fs-public/2020-Fireworks-Report.pdf">CPSC Fireworks Reports</a></li>
<li><a href="https://www.who.int/news-room/fact-sheets/detail/burns">WHO Burns</a></li>
</ul></li>
</ol>
</section>
<section id="recovery-transitions" class="level3">
<h3 class="anchored" data-anchor-id="recovery-transitions">Recovery Transitions</h3>
<ol start="5" type="1">
<li><strong>From Minor Injury to No Injury</strong>
<ul>
<li>Probability: 85%</li>
<li>Based on general epidemiological data and recovery rates from burns and trauma.</li>
<li>Peck MD. Epidemiology of burns throughout the world. Part I: Distribution and risk factors. Burns. 2011;37(7):1087-1100.</li>
<li>Brusselaers N, Monstrey S, Vogelaers D, Hoste E, Blot S. Severe burn injury in Europe: a systematic review of the incidence, etiology, morbidity, and mortality. Crit Care. 2010;14(5):R188.</li>
</ul></li>
<li><strong>From Minor Injury to Recovered with Sequelae</strong>
<ul>
<li>Probability: 10%</li>
<li>Based on general epidemiological data and recovery rates from burns and trauma.</li>
<li>Peck MD. Epidemiology of burns throughout the world. Part I: Distribution and risk factors. Burns. 2011;37(7):1087-1100.</li>
<li>Brusselaers N, Monstrey S, Vogelaers D, Hoste E, Blot S. Severe burn injury in Europe: a systematic review of the incidence, etiology, morbidity, and mortality. Crit Care. 2010;14(5):R188.</li>
</ul></li>
<li><strong>From Minor Injury to Death</strong>
<ul>
<li>Probability: 5%</li>
<li>Based on general epidemiological data and recovery rates from burns and trauma.</li>
<li>Peck MD. Epidemiology of burns throughout the world. Part I: Distribution and risk factors. Burns. 2011;37(7):1087-1100.</li>
<li>Brusselaers N, Monstrey S, Vogelaers D, Hoste E, Blot S. Severe burn injury in Europe: a systematic review of the incidence, etiology, morbidity, and mortality. Crit Care. 2010;14(5):R188.</li>
</ul></li>
<li><strong>From Moderate Injury to No Injury</strong>
<ul>
<li>Probability: 50%</li>
<li>Based on general epidemiological data and recovery rates from burns and trauma.</li>
<li>Peck MD. Epidemiology of burns throughout the world. Part I: Distribution and risk factors. Burns. 2011;37(7):1087-1100.</li>
<li>Brusselaers N, Monstrey S, Vogelaers D, Hoste E, Blot S. Severe burn injury in Europe: a systematic review of the incidence, etiology, morbidity, and mortality. Crit Care. 2010;14(5):R188.</li>
</ul></li>
<li><strong>From Moderate Injury to Recovered with Sequelae</strong>
<ul>
<li>Probability: 40%</li>
<li>Based on general epidemiological data and recovery rates from burns and trauma.</li>
<li>Peck MD. Epidemiology of burns throughout the world. Part I: Distribution and risk factors. Burns. 2011;37(7):1087-1100.</li>
<li>Brusselaers N, Monstrey S, Vogelaers D, Hoste E, Blot S. Severe burn injury in Europe: a systematic review of the incidence, etiology, morbidity, and mortality. Crit Care. 2010;14(5):R188.</li>
</ul></li>
<li><strong>From Moderate Injury to Death from Injury</strong>
<ul>
<li>Probability: 10%</li>
<li>Based on general epidemiological data and recovery rates from burns and trauma.</li>
<li>Peck MD. Epidemiology of burns throughout the world. Part I: Distribution and risk factors. Burns. 2011;37(7):1087-1100.</li>
<li>Brusselaers N, Monstrey S, Vogelaers D, Hoste E, Blot S. Severe burn injury in Europe: a systematic review of the incidence, etiology, morbidity, and mortality. Crit Care. 2010;14(5):R188.</li>
</ul></li>
<li><strong>From Severe Injury to No Injury</strong>
<ul>
<li>Probability: 20%</li>
<li>Based on general epidemiological data and recovery rates from burns and trauma.</li>
<li>Peck MD. Epidemiology of burns throughout the world. Part I: Distribution and risk factors. Burns. 2011;37(7):1087-1100.</li>
<li>Brusselaers N, Monstrey S, Vogelaers D, Hoste E, Blot S. Severe burn injury in Europe: a systematic review of the incidence, etiology, morbidity, and mortality. Crit Care. 2010;14(5):R188.</li>
</ul></li>
</ol>
</section>
</section>
<section id="proposed-health-state-utility-values" class="level2">
<h2 class="anchored" data-anchor-id="proposed-health-state-utility-values">Proposed Health State Utility Values</h2>
<ol type="1">
<li><strong>No Injury (Healthy)</strong>
<ul>
<li>Utility Value: 1.0 (or slightly less to reflect normal life variability, e.g., 0.95)</li>
</ul></li>
<li><strong>Minor Injury</strong>
<ul>
<li>Utility Value: 0.98</li>
<li>Rationale: Minor injuries such as small burns or cuts typically have a temporary and moderate impact on quality of life.</li>
</ul></li>
<li><strong>Moderate Injury</strong>
<ul>
<li>Utility Value: 0.9 if sequelae; 0.95 if not.</li>
<li>Rationale: Moderate injuries, including more severe burns and lacerations, have a more significant but still temporary impact on quality of life.</li>
</ul></li>
<li><strong>Severe Injury</strong>
<ul>
<li><p>Utility Value: 0.60</p></li>
<li><p>Rationale: Severe injuries such as major burns, limb injuries, or serious eye damage substantially reduce quality of life and may involve long recovery periods.</p></li>
<li><p>Holtslag HR, Post MW, Lindeman E, van der Werken C. “Long-term functional health status of severely injured patients.” Injury. 2007;38(3):280-289.</p></li>
<li><p>Ringburg AN, Polinder S, van Ierland MC, Steyerberg EW, van Lieshout EM, Patka P, van Vugt AB, Schipper IB. “Prevalence and prognostic factors of disability after major trauma.” The Journal of Trauma. 2011;70(4):916-922.</p></li>
<li><p>Esselman PC, Thombs BD, Magyar-Russell G, Fauerbach JA. “Burn rehabilitation: state of the science.” American Journal of Physical Medicine &amp; Rehabilitation. 2006;85(4):383-413.</p></li>
<li><p>Browne AL, Biering-Sørensen F, Kennelly M, Noonan VK, Post MWM, Middleton JW, et al.&nbsp;“Spinal Cord Injury–Related Functional Outcomes in a Prospective Multicenter Study.” The Journal of Spinal Cord Medicine. 2016;39(2):155-166.</p></li>
</ul></li>
<li><strong>Severe: Recovered with Sequelae</strong>
<ul>
<li>Utility Value: 0.75</li>
<li>Rationale: Individuals who have recovered but suffer from long-term sequelae (e.g., chronic pain, scarring) experience a permanent reduction in quality of life, although it may be less severe than during the acute injury phase.</li>
</ul></li>
<li><strong>Death</strong>
<ul>
<li>Utility Value: 0.0</li>
</ul></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'kableExtra'

The following object is masked from 'package:dplyr':

    group_rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexsurv)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dampack)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'

The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at /Users/johngraves/Dropbox/teaching/bogota-vital-strategies</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(demography)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: forecast
Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo 
Registered S3 methods overwritten by 'demography':
  method      from 
  print.lca   e1071
  summary.lca e1071
This is demography 2.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MortalityLaws)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(demography)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'

The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(directlabels)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(expm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'expm'

The following object is masked from 'package:Matrix':

    expm</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(directlabels)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsci)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(hrbrthemes<span class="sc">::</span><span class="fu">theme_ipsum</span>(<span class="at">base_family =</span> <span class="st">"Arial"</span>))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"scipen"</span> <span class="ot">=</span> <span class="dv">100</span>, <span class="st">"digits"</span> <span class="ot">=</span> <span class="dv">5</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>select <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>select</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Columbia Life Tables</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Source: https://apps.who.int/gho/data/view.searo.LT62020?lang=en</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>lt_lut <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tx - person-years lived above age x"</span> <span class="ot">=</span> <span class="st">"Tx"</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ex - expectation of life at age x"</span> <span class="ot">=</span> <span class="st">"ex"</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lx - number of people left alive at age x"</span> <span class="ot">=</span> <span class="st">"lx"</span>,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nLx - person-years lived between ages x and x+n"</span> <span class="ot">=</span> <span class="st">"Lx"</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nMx - age-specific death rate between ages x and x+n"</span> <span class="ot">=</span> <span class="st">"mx"</span>,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ndx - number of people dying between ages x and x+n"</span> <span class="ot">=</span> <span class="st">"dx"</span>,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nqx - probability of dying between ages x and x+n"</span> <span class="ot">=</span> <span class="st">"qx"</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>x_lut <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">" &amp;lt;1 year"</span> <span class="ot">=</span> <span class="st">"0"</span>, </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">" 1-4 years"</span> <span class="ot">=</span> <span class="st">"1"</span>, </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">" 10-14 years"</span> <span class="ot">=</span> <span class="st">"10"</span>,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">" 15-19  years"</span> <span class="ot">=</span> <span class="st">"15"</span>,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">" 20-24 years"</span> <span class="ot">=</span> <span class="st">"20"</span>,</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">" 25-29 years"</span> <span class="ot">=</span> <span class="st">"25"</span>,</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">" 30-34 years"</span>  <span class="ot">=</span> <span class="st">"30"</span>,</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a> <span class="st">" 35-39 years"</span> <span class="ot">=</span> <span class="st">"35"</span>,</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a> <span class="st">" 40-44 years"</span> <span class="ot">=</span> <span class="st">"40"</span>,</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a> <span class="st">" 45-49 years"</span> <span class="ot">=</span> <span class="st">"45"</span>,</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a> <span class="st">" 5-9 years"</span> <span class="ot">=</span> <span class="st">"5"</span>,</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a> <span class="st">" 50-54 years"</span>  <span class="ot">=</span> <span class="st">"50"</span>,</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a> <span class="st">" 55-59 years"</span> <span class="ot">=</span> <span class="st">"55"</span>,</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a> <span class="st">" 60-64 years"</span>   <span class="ot">=</span> <span class="st">"60"</span>,</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a> <span class="st">" 65-69 years"</span> <span class="ot">=</span> <span class="st">"65"</span>,</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a> <span class="st">" 70-74 years"</span> <span class="ot">=</span> <span class="st">"70"</span>, </span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a> <span class="st">" 75-79 years"</span> <span class="ot">=</span> <span class="st">"75"</span>,</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a> <span class="st">" 80-84 years"</span> <span class="ot">=</span> <span class="st">"80"</span>,</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a> <span class="st">" 85+ years"</span>   <span class="ot">=</span> <span class="st">"85"</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>lt <span class="ot">&lt;-</span> </span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"case-studies/columbia-who-life-table_2024-06-06.csv"</span>),<span class="at">skip =</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">indicator2 =</span> lt_lut[indicator]) <span class="sc">%&gt;%</span> </span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> x_lut[age_group]) <span class="sc">%&gt;%</span> </span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(indicator2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"mx"</span>,<span class="st">"Tx"</span>,<span class="st">"ex"</span>,<span class="st">"lx"</span>,<span class="st">"Lx"</span>,<span class="st">"dx"</span>,<span class="st">"qx"</span>))   <span class="sc">%&gt;%</span> </span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x,both_sexes, indicator2) <span class="sc">%&gt;%</span> </span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(indicator2,both_sexes) <span class="sc">%&gt;%</span> </span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">age =</span> x,mx,qx,lx,dx,Lx,Tx) <span class="sc">%&gt;%</span> </span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(age))) <span class="sc">%&gt;%</span> </span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(age)</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>lt <span class="sc">%&gt;%</span> <span class="fu">write.csv</span>(<span class="fu">here</span>(<span class="st">"case-studies/columbia-life-table.csv"</span>))</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: have to manually go in and delete row name column!</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>ages     <span class="ot">&lt;-</span> lt<span class="sc">$</span>age[lt<span class="sc">$</span>age<span class="sc">&lt;</span><span class="dv">100</span>]</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>deaths   <span class="ot">&lt;-</span> lt<span class="sc">$</span>dx[lt<span class="sc">$</span>age<span class="sc">&lt;</span><span class="dv">100</span>]</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>exposure <span class="ot">&lt;-</span> lt<span class="sc">$</span>Lx[lt<span class="sc">$</span>age<span class="sc">&lt;</span><span class="dv">100</span>]</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>hp_fit <span class="ot">&lt;-</span> <span class="fu">MortalityLaw</span>(</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>                <span class="at">x  =</span> ages,      <span class="co"># vector with ages</span></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>                <span class="at">Dx  =</span> deaths,   <span class="co"># vector with death counts</span></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>                <span class="at">Ex  =</span> exposure, <span class="co"># vector containing exposures</span></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>                <span class="at">law =</span> <span class="st">"HP2"</span>,</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>                <span class="at">opt.method =</span> <span class="st">"LF2"</span>)</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hp_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="markov-injury-planning_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the mortality rate</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>df_p_Die <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">index =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">110</span>, <span class="at">p_die =</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">HP2</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">110</span>, <span class="at">par =</span> hp_fit<span class="sc">$</span>coefficients)<span class="sc">$</span>hx)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(df_p_Die) <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>df_p_Die <span class="sc">%&gt;%</span> <span class="fu">write.csv</span>(<span class="fu">here</span>(<span class="st">"case-studies/columbia-life-table-death-probabilities.csv"</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind.data.frame</span>(<span class="at">hp =</span> <span class="fu">HP2</span>(<span class="at">x =</span> lt<span class="sc">$</span>age, <span class="at">par =</span> hp_fit<span class="sc">$</span>coefficients)<span class="sc">$</span>hx, <span class="at">lt =</span> lt<span class="sc">$</span>mx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           hp         lt
1  0.01142097 0.01142101
2  0.00048104 0.00047666
3  0.00021015 0.00021911
4  0.00031204 0.00027794
5  0.00075860 0.00087991
6  0.00117540 0.00123863
7  0.00136183 0.00120281
8  0.00138903 0.00131325
9  0.00140379 0.00136937
10 0.00154789 0.00163671
11 0.00197028 0.00211614
12 0.00287671 0.00307737
13 0.00460372 0.00503838
14 0.00772997 0.00769663
15 0.01325164 0.01147761
16 0.02285523 0.01977460
17 0.03930889 0.03638906
18 0.06691615 0.05818927
19 0.11174029 0.13535387</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 101 × 11</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     year     x       mx       qx      lx    dx    Lx    Tx    ex country   age</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  1  2019     0 0.00556  0.00553  100000  553.  0.995  79.0  79.0 USA         0</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  2  2019     1 0.000384 0.000384  99447.  38.2 0.994  78.0  78.4 USA         1</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  3  2019     2 0.000233 0.000233  99409.  23.2 0.994  77.0  77.4 USA         2</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  4  2019     3 0.000178 0.000178  99385.  17.7 0.994  76.0  76.4 USA         3</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  5  2019     4 0.000143 0.000143  99368.  14.2 0.994  75.0  75.5 USA         4</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  6  2019     5 0.000133 0.000133  99354.  13.2 0.993  74.0  74.5 USA         5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">=</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">t_names =</span> <span class="fu">c</span>(          <span class="co"># Strategy names</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"heligman-pollard"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"foo"</span>),          </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_treatments =</span> <span class="dv">2</span>,                 <span class="co"># Number of treatments</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">s_names  =</span> <span class="fu">c</span>(<span class="st">"Alive"</span>, <span class="st">"Dead"</span>),    <span class="co"># State names</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_states =</span> <span class="dv">2</span>,                     <span class="co"># Number of states</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cohort =</span> <span class="dv">1</span>,                <span class="co"># Cohort size</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">initial_age =</span> <span class="dv">0</span>,                 <span class="co"># Cohort starting age    </span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cycles =</span> <span class="dv">110</span>,                   <span class="co"># Number of cycles in model.  </span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cycle =</span> <span class="dv">1</span>,                        <span class="co"># Cycle length</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">hp_fit =</span> hp_fit                   <span class="co"># Fitted Heligman-Pollard model object</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-12-1"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a>fn_mPt <span class="ot">&lt;-</span> <span class="cf">function</span>(t, params) {</span>
<span id="annotated-cell-12-2"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(params, {</span>
<span id="annotated-cell-12-3"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a>    h <span class="ot">=</span> cycle <span class="co"># Time step</span></span>
<span id="annotated-cell-12-4"><a href="#annotated-cell-12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(t, <span class="cf">function</span>(tt){</span>
<span id="annotated-cell-12-5"><a href="#annotated-cell-12-5" aria-hidden="true" tabindex="-1"></a>       <span class="co"># Life table method</span></span>
<span id="annotated-cell-12-6"><a href="#annotated-cell-12-6" aria-hidden="true" tabindex="-1"></a>        current_age_lt <span class="ot">=</span> <span class="fu">pmin</span>(initial_age  <span class="sc">+</span> (tt)<span class="sc">*</span>h <span class="sc">-</span> <span class="dv">1</span>,<span class="fu">max</span>(lt<span class="sc">$</span>age))</span>
<span id="annotated-cell-12-7"><a href="#annotated-cell-12-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">#p_death &lt;- lt[lt$age==current_age_lt,"qx"]</span></span>
<span id="annotated-cell-12-8"><a href="#annotated-cell-12-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># parametric mortality methods</span></span>
<span id="annotated-cell-12-9"><a href="#annotated-cell-12-9" aria-hidden="true" tabindex="-1"></a>        current_age <span class="ot">=</span> initial_age  <span class="sc">+</span> (tt)<span class="sc">*</span>h <span class="sc">-</span> <span class="dv">1</span></span>
<span id="annotated-cell-12-10"><a href="#annotated-cell-12-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">#r_death_gompertz &lt;- gompertz(current_age,params$gom_fit$coefficients)$hx</span></span>
<span id="annotated-cell-12-11"><a href="#annotated-cell-12-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">#p_death_gompertz &lt;- 1 - exp(-r_death_gompertz)</span></span>
<span id="annotated-cell-12-12"><a href="#annotated-cell-12-12" aria-hidden="true" tabindex="-1"></a>        r_death_hp <span class="ot">&lt;-</span> <span class="fu">HP</span>(current_age, params<span class="sc">$</span>hp_fit<span class="sc">$</span>coefficients)<span class="sc">$</span>hx</span>
<span id="annotated-cell-12-13"><a href="#annotated-cell-12-13" aria-hidden="true" tabindex="-1"></a>        p_death_hp <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>r_death_hp)</span>
<span id="annotated-cell-12-14"><a href="#annotated-cell-12-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="annotated-cell-12-15"><a href="#annotated-cell-12-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">array</span>(<span class="at">data =</span> <span class="fu">c</span>(</span>
<span id="annotated-cell-12-16"><a href="#annotated-cell-12-16" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">1</span> <span class="sc">-</span> p_death_hp, <span class="dv">0</span>, </span>
<span id="annotated-cell-12-17"><a href="#annotated-cell-12-17" aria-hidden="true" tabindex="-1"></a>                 p_death_hp,<span class="dv">1</span>,</span>
<span id="annotated-cell-12-18"><a href="#annotated-cell-12-18" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="annotated-cell-12-19"><a href="#annotated-cell-12-19" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">1</span> <span class="sc">-</span> p_death_hp, <span class="dv">0</span>, </span>
<span id="annotated-cell-12-20"><a href="#annotated-cell-12-20" aria-hidden="true" tabindex="-1"></a>                 p_death_hp,<span class="dv">1</span></span>
<span id="annotated-cell-12-21"><a href="#annotated-cell-12-21" aria-hidden="true" tabindex="-1"></a>                 ),</span>
<span id="annotated-cell-12-22"><a href="#annotated-cell-12-22" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="annotated-cell-12-23"><a href="#annotated-cell-12-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">dim =</span> <span class="fu">c</span>(n_states, n_states, n_treatments),</span>
<span id="annotated-cell-12-24"><a href="#annotated-cell-12-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">from =</span> s_names,</span>
<span id="annotated-cell-12-25"><a href="#annotated-cell-12-25" aria-hidden="true" tabindex="-1"></a>                              <span class="at">to =</span> s_names,</span>
<span id="annotated-cell-12-26"><a href="#annotated-cell-12-26" aria-hidden="true" tabindex="-1"></a>                              t_names)) </span>
<span id="annotated-cell-12-27"><a href="#annotated-cell-12-27" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="annotated-cell-12-28"><a href="#annotated-cell-12-28" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="annotated-cell-12-29"><a href="#annotated-cell-12-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-12-30"><a href="#annotated-cell-12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-31"><a href="#annotated-cell-12-31" aria-hidden="true" tabindex="-1"></a>params<span class="sc">$</span>mP <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-12-32"><a href="#annotated-cell-12-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fn_mPt</span>(<span class="dv">1</span><span class="sc">:</span>params<span class="sc">$</span>n_cycles, params)</span>
<span id="annotated-cell-12-33"><a href="#annotated-cell-12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-34"><a href="#annotated-cell-12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-35"><a href="#annotated-cell-12-35" aria-hidden="true" tabindex="-1"></a>sim_cohort <span class="ot">&lt;-</span> <span class="cf">function</span>(params) {</span>
<span id="annotated-cell-12-36"><a href="#annotated-cell-12-36" aria-hidden="true" tabindex="-1"></a> params<span class="sc">$</span>t_names <span class="sc">%&gt;%</span> <span class="fu">map</span>(<span class="sc">~</span>({ </span>
<span id="annotated-cell-12-37"><a href="#annotated-cell-12-37" aria-hidden="true" tabindex="-1"></a>    tr_ <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">c</span>(<span class="st">"alive"</span> <span class="ot">=</span> params<span class="sc">$</span>n_cohort, <span class="st">"dead"</span> <span class="ot">=</span> <span class="dv">0</span>))</span>
<span id="annotated-cell-12-38"><a href="#annotated-cell-12-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-12-39"><a href="#annotated-cell-12-39" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind,<span class="fu">lapply</span>(params<span class="sc">$</span>mP, <span class="cf">function</span>(tp) {</span>
<span id="annotated-cell-12-40"><a href="#annotated-cell-12-40" aria-hidden="true" tabindex="-1"></a>        tr_ <span class="ot">&lt;&lt;-</span> tr_ <span class="sc">%*%</span> <span class="fu">matrix</span>(<span class="fu">unlist</span>(tp[,,.x]),<span class="at">nrow=</span>params<span class="sc">$</span>n_state)</span>
<span id="annotated-cell-12-41"><a href="#annotated-cell-12-41" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="annotated-cell-12-42"><a href="#annotated-cell-12-42" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(params<span class="sc">$</span>n_cohort,<span class="dv">0</span>),res) </span>
<span id="annotated-cell-12-43"><a href="#annotated-cell-12-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(res) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">paste0</span>(<span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span>params<span class="sc">$</span>n_cycles)), params<span class="sc">$</span>s_names)</span>
<span id="annotated-cell-12-44"><a href="#annotated-cell-12-44" aria-hidden="true" tabindex="-1"></a>    res</span>
<span id="annotated-cell-12-45"><a href="#annotated-cell-12-45" aria-hidden="true" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-12-46"><a href="#annotated-cell-12-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(params<span class="sc">$</span>t_names)</span>
<span id="annotated-cell-12-47"><a href="#annotated-cell-12-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-12-48"><a href="#annotated-cell-12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-49"><a href="#annotated-cell-12-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct the Markov trace. </span></span>
<span id="annotated-cell-12-50"><a href="#annotated-cell-12-50" aria-hidden="true" tabindex="-1"></a>trace <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-12-51"><a href="#annotated-cell-12-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sim_cohort</span>(params)</span>
<span id="annotated-cell-12-52"><a href="#annotated-cell-12-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-53"><a href="#annotated-cell-12-53" aria-hidden="true" tabindex="-1"></a>payoff_life_exp <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Alive"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Dead"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="annotated-cell-12-54"><a href="#annotated-cell-12-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-55"><a href="#annotated-cell-12-55" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((trace[[<span class="dv">1</span>]] <span class="sc">%*%</span> payoff_life_exp) <span class="sc">*</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(trace[[<span class="dv">1</span>]])<span class="sc">-</span><span class="dv">2</span>),<span class="fl">0.5</span>))</span>
<span id="annotated-cell-12-56"><a href="#annotated-cell-12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-57"><a href="#annotated-cell-12-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate alive years in each cycle</span></span>
<span id="annotated-cell-12-58"><a href="#annotated-cell-12-58" aria-hidden="true" tabindex="-1"></a>life_exp_cycle <span class="ot">=</span> <span class="fu">lapply</span>(trace, <span class="cf">function</span>(tr) (tr<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">/</span> params<span class="sc">$</span>n_cohort)) <span class="sc">%*%</span></span>
<span id="annotated-cell-12-59"><a href="#annotated-cell-12-59" aria-hidden="true" tabindex="-1"></a>                 payoff_life_exp)</span>
<span id="annotated-cell-12-60"><a href="#annotated-cell-12-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-61"><a href="#annotated-cell-12-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Integration via alternative Simpson's method (cycle correction)</span></span>
<span id="annotated-cell-12-62"><a href="#annotated-cell-12-62" aria-hidden="true" tabindex="-1"></a>alt_simp_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(i) <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">59</span>, <span class="dv">43</span>, <span class="dv">49</span>, <span class="fu">rep</span>(<span class="dv">48</span>, i<span class="dv">-8</span>),</span>
<span id="annotated-cell-12-63"><a href="#annotated-cell-12-63" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">49</span>, <span class="dv">43</span>, <span class="dv">59</span>, <span class="dv">17</span>) <span class="sc">/</span> <span class="dv">48</span></span>
<span id="annotated-cell-12-64"><a href="#annotated-cell-12-64" aria-hidden="true" tabindex="-1"></a>cycle_adj     <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">alt_simp_coef</span>(<span class="fu">length</span>(x)) <span class="sc">*</span> x)</span>
<span id="annotated-cell-12-65"><a href="#annotated-cell-12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-66"><a href="#annotated-cell-12-66" aria-hidden="true" tabindex="-1"></a>total_life_exp <span class="ot">=</span> <span class="fu">lapply</span>(life_exp_cycle,cycle_adj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 77.06</code></pre>
</div>
</div>
<!-- ### Sources  -->
<!-- 1. **Tengs TO, Wallace A. One thousand health-related quality-of-life estimates. Medical Care. 2000;38(6):583-637.** -->
<!--    - Provides a comprehensive list of health-related quality-of-life estimates across a range of conditions. -->
<!-- 2. **Gabriel SE, Crowson CS, O’Fallon WM. A cost-effectiveness analysis of total hip arthroplasty. Clinical Orthopaedics and Related Research. 1999;(358):123-133.** -->
<!--    - Utility values for different health states, particularly related to injuries and chronic conditions. -->
<!-- 3. **Torrance GW, Feeny D, Furlong W, Barr RD, Zhang Y, Wang Q. Multiattribute utility function for a comprehensive health status classification system. Health Utilities Index Mark 2. Medical Care. 1996;34(7):702-722.** -->
<!--    - Provides utility values based on comprehensive health status classification systems. -->
<!-- 4. **EuroQol Group. EuroQol--a new facility for the measurement of health-related quality of life. Health Policy. 1990;16(3):199-208.** -->
<!--    - Details on the EQ-5D, a widely used instrument for measuring health-related quality of life. -->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>